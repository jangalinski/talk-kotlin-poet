---
title: "Kotlin Meta Programming - Code Generation with Kotlin Poet"
center: true
theme: night
transition: slide
---
<!-- slide bg="[[code-talks-start.png]]" -->

Jan Galinski
<br/>
## Code Generation with Kotlin Poet

Backend Applications & Services

note: 
* Thanks for being here after the great conference
* endspurt

---
<!-- .slide: data-auto-animate -->

<i class="fas fa-book-open fa-4x"></i>

## Let's start 
## with a story

--
<!-- .slide: data-auto-animate -->
### Girls & Boys Day 2023

![[dinner-process.svg]]

ChatGPT powered _what to cook for dinner?_ process

note: girls and boys day 
- fuck
- camunda process & chat gpt
-  if kids can do this --- managers can two as well
-  but: does it work? is the receipe correct? are all items on the grocery shopping list?

--
<!-- .slide: data-auto-animate -->
### Girls & Boys Day 2023

![[dinner-process.svg]]

<small>https://github.com/holunda-io/camunda-8-connector-gpt</small>

--

<!-- .slide: data-auto-animate -->
<i class="fas fa-question-circle fa-4x"></i>

## How can we ...

+ ... reduce manual coding?
+ ... ensure high quality?

--
<!-- .slide: data-auto-animate -->

### Abstract

<small>
AI code generation is a challenge for our daily work. But do we want to rely on some chat comments for professional software development? 
There must be a middle way between manual coding and c&p from the internet. <!-- .element: style="font-size: 24px" align="justify" -->

Luckily there is: meta-programming. In short: write software that writes software. 
We will have a look at practical implementations using the Kotlin Poet language model lib and maven  plugin infrastructure.<!-- .element: style="font-size: 24px" align="justify" -->
</small>

notes:

* Irony: this abstract was generated by ChatGPT

--

## Let there be code.

---

<!-- slide bg="[[kotlin-bg-black.svg]]" -->

<grid drag="70 100" drop="right">

<i class="fas fa-question-circle fa-4x"></i>

## About me

</grid>

--
<!-- slide bg="[[c64-simon_ist_doof.svg]]" style="color:#6C5FB5"-->

+ First program in 1986 - BASIC/C64
+ ... before I even owned the machine

--
<!-- slide bg="[[c64-empty.svg]]" -->

<grid drop="left" style="color:#6C5FB5">

+ Senior Consultant [@HolisticonAG](https://holisticon.de)
+ 20+ years of industry experience
+ Kotlin - Fan
+ ... Backend/spring boot - no Android
+ ... prefers maven over gradle
+ ... uses light mode

</grid>

<grid drop="right">
![[jg-comic.svg]]
[about.me/jangalinski](https://about.me/jangalinski)
</grid>

---

<!-- slide bg="[[kotlin-bg-black.svg]]" -->

<grid drag="70 100" drop="right">

### Agenda

* What is Meta Programming?
* How does it work? - Live Coding
* Where to go from here?

</grid>

--

<!-- slide bg="[[images/meta-taal-lake.jpg]]" -->

# What is Meta  Programming?

<grid drop="bottom"  drag="100 6"  >
  <small>image: https://www.filipinotravel.com.ph/lake-taal/</small>
</grid>

--

<i class="fab fa-wikipedia-w fa-3x"></i>

**Metaprogramming** is a *programming technique*  in which computer programs have the ability to *treat ~~other~~ programs as their data*.

**Metaprogramming** can be used to *move computations from run-time to compile-time*, to *generate code* using compile time computations, and to *enable self-modifying code*.

notes:

* Program means "all parts of software", so read/write documentation or 

--

<!-- slide bg="[[kotlin-color-bg.svg]]" -->
#### Types of Meta Programming

![[types-of-meta-programming.svg|600]]

<grid  drag="30 38" drop="-18 13"   opacity="0.4" bg="lightcoral"     /><!-- element class="fragment" -->


note:

* Basically: Reflection vs. Code Generation
* quadrantChart

  x-axis Runtime -->Compile Time
  y-axis Byte Code -->Source Code
  quadrant-1 Code Generation
  quadrant-2 NOPE
  quadrant-3 Reflection

  OpenAPI/Swagger: [0.7,0.8]
  Avro: [0.6,0.9]
  WSDL/Soap: [0.75,0.9]
  Mapstruct: [0.8, 0.7]

  Spring Boot: [0.1,0.2]
  CGLib: [0.3,0.3]

  GraalVM: [0.8,0.2]
  Lombok: [0.75, 0.3]
  Byte Buddy: [0.7,0.1]
  ASM: [0.9,0.2]



--

### Types of Source Code Generators

- Annotation Processing
  -  mapstruct
- Command Line Console
  - swagger
- Build Plugins (maven, gradle)
  - swagger, avro 

--

### Tools for Source Code Generation

- Basically, create an ASCII file
- Popular: Template Engines (mustache, velocity, ...)
+ Or ... __Kotlin Poet__

note:

* Tools:
  * sun.codemodel
  * roaster
  * java poet
  * spoon

--

## I don't like templates

```mustache
{{#useBeanValidation}}
	{{>beanValidation}}
	{{>beanValidationModel}}
{{/useBeanValidation}}
{{#swagger2AnnotationLibrary}}
  @Schema({{#example}}example = "{{#lambdaRemoveLineBreak}}
  {{#lambdaEscapeDoubleQuote}}{{{.}}}{{/lambdaEscapeDoubleQuote}}{{/lambdaRemoveLineBreak}}", 
  {{/example}}required = true, 
  {{#isReadOnly}}readOnly = {{{isReadOnly}}},{{/isReadOnly}}description = "{{{description}}}"){{/swagger2AnnotationLibrary}}
{{#swagger1AnnotationLibrary}}
  @ApiModelProperty({{#example}}example = "{{#lambdaRemoveLineBreak}}{{#lambdaEscapeDoubleQuote}}{{{.}}}{{/lambdaEscapeDoubleQuote}}{{/lambdaRemoveLineBreak}}", {{/example}}required = true, {{#isReadOnly}}readOnly = {{{isReadOnly}}}, {{/isReadOnly}}value = "{{{description}}}"){{/swagger1AnnotationLibrary}}
  
@get:JsonProperty("{{{baseName}}}", required = true){{#isInherited}} override{{/isInherited}} {{>modelMutable}} {{{name}}}: {{#isEnum}}{{#isArray}}{{baseType}}<{{/isArray}}{{#isInherited}}{{parent}}.{{/isInherited}}{{^isInherited}}{{classname}}.{{/isInherited}}{{{nameInCamelCase}}}{{#isArray}}>{{/isArray}}{{/isEnum}}{{^isEnum}}{{{dataType}}}{{/isEnum}}{{#isNullable}}?{{/isNullable}}{{#defaultValue}} = {{{.}}}{{/defaultValue}}

```
---
<!-- slide bg="[[kotlin-bg-black.svg]]" -->

## Kotlin Poet


--
<!-- slide bg="[[screenshot-kotlinpoet.png]]" -->

<grid  bg="orange">
## Kotlin Poet
</grid>

<grid bg="white">
https://square.github.io/kotlinpoet/
</grid>


---

Kotlin Poet

Non Linear generation

---

#### Should I use Kotlin Poet for code generation?

<div style="height:480px">
<canvas data-chart="pie">
<!--
{
  "data" : {
    "datasets": [
       {
           "data":[40,10],
           "backgroundColor": [ "blue","yellow" ]
       }
   ],
   "labels": [
        "YES",
        "Also YES, but in yellow"
    ]
  }
}
-->
</canvas>
</div>
---

<canvas class="stretch" data-chart="line">
My first dataset, 65, 59, 80, 81, 56, 55, 40
<!-- This is a comment that will be ignored -->
My second dataset, 28, 48, 40, 19, 86, 27, 90
<!--
{
 "data" : {
  "labels" : ["Enero", "Febrero", "Marzo", "Avril", "Mayo", "Junio", "Julio"],
  "datasets" : [{ "borderColor": "#0f0", "borderDash": ["5","10"] }, { "borderColor": "#0ff" } ]
 }
}
-->
</canvas>

---
  
## Pie chart

<div style="height:600px">
<canvas data-chart="pie">
,Black, Red, Green, Yellow
My first dataset, 40, 40, 20, 6
My second dataset, 45, 40, 25, 4
</canvas>
</div>

---
# Links

* [kotlin poet](https://square.github.io/kotlinpoet/) - KotlinPoet is a Kotlin and Java API for generating .kt source files. Source file generation can be useful when doing things such as annotation processing or interacting with metadata files (e.g., database schemas, protocol formats). By generating code, you eliminate the need to write boilerplate while also keeping a single source of truth for the metadata.
* [c64 emulator](https://c64emulator.111mb.de/index.php?site=home&group=c64)
* [obsidian - advanced slides](https://mszturc.github.io/obsidian-advanced-slides/)

---

<!-- slide bg="[[no understanding.jpg]]" -->

QUESTIONS?

---

# Unstructured

  

Introduction

  


Thoughts on Code generation vs ai 

  

Templating vs language model 

--

<canvas data-chart="line" >
<!--
{
 "data": {
  "labels": ["January"," February"," March"," April"," May"," June"," July"],
  "datasets":[
   {
    "data":[65,59,80,81,56,55,40],
    "label":"My first dataset","backgroundColor":"rgba(20,220,220,.8)"
   },
   {
    "data":[28,48,40,19,86,27,90],
    "label":"My second dataset","backgroundColor":"rgba(220,120,120,.8)"
   }
  ]
 }
}
-->
</canvas>

--

#### Gitgraph Diagrams support

```mermaid
    gitGraph
       commit
       commit
       branch develop
       checkout develop
       commit
       commit
       checkout main
       merge develop
       commit
       commit
    ```


--

```mermaid
mindmap
  root((mindmap))
    Origins
      Long history
      ::icon(fa fa-book)
      Popularisation
        British popular psychology author Tony Buzan
    Research
      On effectiveness<br/>and features
      On Automatic creation
        Uses
            Creative techniques
            Strategic planning
            Argument mapping
    Tools
      Pen and paper
      Mermaid
```
--

Kotlin poet basics 

  

Hello world example

  

Reflection. Metadata. Annotation processing

  

Testing

  

Maven/grade integration
